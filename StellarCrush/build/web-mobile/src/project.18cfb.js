window.__require=function t(e,s,i){function l(c,n){if(!s[c]){if(!e[c]){var h=c.split("/");if(h=h[h.length-1],!e[h]){var a="function"==typeof __require&&__require;if(!n&&a)return a(h,!0);if(o)return o(h,!0);throw new Error("Cannot find module '"+c+"'")}}var r=s[c]={exports:{}};e[c][0].call(r.exports,function(t){return l(e[c][1][t]||t)},r,r.exports,t,e,s,i)}return s[c].exports}for(var o="function"==typeof __require&&__require,c=0;c<i.length;c++)l(i[c]);return l}({AudioUtils:[function(t,e,s){"use strict";cc._RF.push(e,"fe151y+R2lFvas76dyah2Uf","AudioUtils"),cc.Class({extends:cc.Component,properties:{swap:{type:cc.AudioClip,default:null},click:{type:cc.AudioClip,default:null},eliminate:{type:[cc.AudioClip],default:[]},continuousMatch:{type:[cc.AudioClip],default:[]}},onLoad:function(){},start:function(){},playClick:function(){cc.audioEngine.play(this.click,!1,1)},playSwap:function(){cc.audioEngine.play(this.swap,!1,1)},playEliminate:function(t){t=Math.min(this.eliminate.length-1,t),cc.audioEngine.play(this.eliminate[t],!1,1)},playContinuousMatch:function(t){console.log("step = ",t),(t=Math.min(t,11))<2||cc.audioEngine.play(this.continuousMatch[Math.floor(t/2)-1],!1,1)}}),cc._RF.pop()},{}],CellModel:[function(t,e,s){"use strict";cc._RF.push(e,"dae88GCevBMaK7lQqhume8G","CellModel"),Object.defineProperty(s,"__esModule",{value:!0}),s.default=l;var i=t("./ConstValue");function l(){this.type=null,this.status=i.CELL_STATUS.COMMON,this.x=1,this.y=1,this.startX=1,this.startY=1,this.cmd=[],this.isDeath=!1,this.objecCount=Math.floor(1e3*Math.random())}l.prototype.init=function(t){this.type=t},l.prototype.isEmpty=function(){return this.type==i.CELL_TYPE.EMPTY},l.prototype.setEmpty=function(){this.type=i.CELL_TYPE.EMPTY},l.prototype.setXY=function(t,e){this.x=t,this.y=e},l.prototype.setStartXY=function(t,e){this.startX=t,this.startY=e},l.prototype.setStatus=function(t){this.status=t},l.prototype.moveToAndBack=function(t){var e=cc.v2(this.x,this.y);this.cmd.push({action:"moveTo",keepTime:i.ANITIME.TOUCH_MOVE,playTime:0,pos:t}),this.cmd.push({action:"moveTo",keepTime:i.ANITIME.TOUCH_MOVE,playTime:i.ANITIME.TOUCH_MOVE,pos:e})},l.prototype.moveTo=function(t,e){cc.v2(this.x,this.y);this.cmd.push({action:"moveTo",keepTime:i.ANITIME.TOUCH_MOVE,playTime:e,pos:t}),this.x=t.x,this.y=t.y},l.prototype.toDie=function(t){this.cmd.push({action:"toDie",playTime:t,keepTime:i.ANITIME.DIE}),this.isDeath=!0},l.prototype.toShake=function(t){this.cmd.push({action:"toShake",playTime:t,keepTime:i.ANITIME.DIE_SHAKE})},l.prototype.setVisible=function(t,e){this.cmd.push({action:"setVisible",playTime:t,keepTime:0,isVisible:e})},l.prototype.moveToAndDie=function(t){},l.prototype.isBird=function(){return this.type==i.CELL_TYPE.BIRD},e.exports=s.default,cc._RF.pop()},{"./ConstValue":"ConstValue"}],CellView:[function(t,e,s){"use strict";cc._RF.push(e,"fbf19Cx4ptFV62UZ7+qJJpQ","CellView");var i=t("../Model/ConstValue");cc.Class({extends:cc.Component,properties:{defaultFrame:{default:null,type:cc.SpriteFrame}},onLoad:function(){this.isSelect=!1},initWithModel:function(t){this.model=t;var e=t.startX,s=t.startY;this.node.x=i.CELL_WIDTH*(e-.5),this.node.y=i.CELL_HEIGHT*(s-.5);var l=this.node.getComponent(cc.Animation);t.status==i.CELL_STATUS.COMMON?l.stop():l.play(t.status)},updateView:function(){var t=this,e=this.model.cmd;if(!(e.length<=0)){var s,l=[],o=0;for(var c in e){if(e[c].playTime>o){var n=cc.delayTime(e[c].playTime-o);l.push(n)}if("moveTo"==e[c].action){var h=(e[c].pos.x-.5)*i.CELL_WIDTH,a=(e[c].pos.y-.5)*i.CELL_HEIGHT,r=cc.moveTo(i.ANITIME.TOUCH_MOVE,cc.v2(h,a));l.push(r)}else if("toDie"==e[c].action){if(this.status==i.CELL_STATUS.BIRD)this.node.getComponent(cc.Animation).play("effect"),l.push(cc.delayTime(i.ANITIME.BOMB_BIRD_DELAY));var u=cc.callFunc(function(){this.node.destroy()},this);l.push(u)}else if("setVisible"==e[c].action)(function(){var s=e[c].isVisible;l.push(cc.callFunc(function(){this.node.opacity=s?255:0},t))})();else if("toShake"==e[c].action){var p=cc.rotateBy(.4,60);l.push(p)}o=e[c].playTime+e[c].keepTime}if(1==l.length)this.node.runAction(l[0]);else this.node.runAction((s=cc).sequence.apply(s,l))}},setSelect:function(t){var e=this.node.getComponent(cc.Animation),s=this.node.getChildByName("select");0==t&&this.isSelect&&this.model.status==i.CELL_STATUS.COMMON?(e.stop(),this.node.getComponent(cc.Sprite).spriteFrame=this.defaultFrame):t&&this.model.status==i.CELL_STATUS.COMMON?e.play(i.CELL_STATUS.CLICK):t&&this.model.status==i.CELL_STATUS.BIRD&&e.play(i.CELL_STATUS.CLICK),s.active=t,this.isSelect=t}}),cc._RF.pop()},{"../Model/ConstValue":"ConstValue"}],ConstValue:[function(t,e,s){"use strict";cc._RF.push(e,"f9088esGbNBtJmNaJsz0Gq4","ConstValue"),Object.defineProperty(s,"__esModule",{value:!0});s.CELL_TYPE={EMPTY:0,A:1,B:2,C:3,D:4,E:5,F:6,BIRD:7},s.CELL_BASENUM=6,s.CELL_STATUS={COMMON:0,CLICK:"click",LINE:"line",COLUMN:"column",WRAP:"wrap",BIRD:"bird"};var i=s.GRID_WIDTH=9,l=s.GRID_HEIGHT=9,o=s.CELL_WIDTH=70,c=s.CELL_HEIGHT=70;s.GRID_PIXEL_WIDTH=i*o,s.GRID_PIXEL_HEIGHT=l*c,s.ANITIME={TOUCH_MOVE:.3,DIE:.2,DOWN:.5,BOMB_DELAY:.3,BOMB_BIRD_DELAY:.7,DIE_SHAKE:.4};cc._RF.pop()},{}],EffectLayer:[function(t,e,s){"use strict";cc._RF.push(e,"0e925myn0dIjqdao1TpipF9","EffectLayer");var i=t("../Model/ConstValue"),l=function(t){return t&&t.__esModule?t:{default:t}}(t("../Utils/AudioUtils"));cc.Class({extends:cc.Component,properties:{bombWhite:{default:null,type:cc.Prefab},crushEffect:{default:null,type:cc.Prefab},audioUtils:{type:l.default,default:null}},onLoad:function(){},playEffects:function(t){if(t&&!(t.length<=0)){var e={};t.forEach(function(t){var s=cc.delayTime(t.playTime),l=cc.callFunc(function(){var s=null,l=null;"crush"==t.action?((l=(s=cc.instantiate(this.crushEffect)).getComponent(cc.Animation)).play("effect"),!e["crush"+t.playTime]&&this.audioUtils.playEliminate(t.step),e["crush"+t.playTime]=!0):"rowBomb"==t.action?(l=(s=cc.instantiate(this.bombWhite)).getComponent(cc.Animation)).play("effect_line"):"colBomb"==t.action&&(l=(s=cc.instantiate(this.bombWhite)).getComponent(cc.Animation)).play("effect_col"),s.x=i.CELL_WIDTH*(t.pos.x-.5),s.y=i.CELL_WIDTH*(t.pos.y-.5),s.parent=this.node,l.on("finished",function(){s.destroy()},this)},this);this.node.runAction(cc.sequence(s,l))},this)}}}),cc._RF.pop()},{"../Model/ConstValue":"ConstValue","../Utils/AudioUtils":"AudioUtils"}],GameController:[function(t,e,s){"use strict";cc._RF.push(e,"5ac64Iq16lBqrHZ0246FRcZ","GameController");var i=function(t){return t&&t.__esModule?t:{default:t}}(t("../Model/GameModel"));cc.Class({extends:cc.Component,properties:{grid:{default:null,type:cc.Node},gameover:{default:null,type:cc.Node},scoreDisplay:{default:null,type:cc.Label},scoreDisplayEnd:{default:null,type:cc.Label}},onLoad:function(){this.gameover.active=!1,this.gameModel=new i.default,this.gameModel.init(6);var t=this.grid.getComponent("GridView");t.setController(this),t.initWithCellModels(this.gameModel.getCells()),this.gameModel.printInfo(),this.startTime=0,this.curTime=0,this.isClick=!1},displayScore:function(){this.scoreDisplay.string="Score :"+this.gameModel.gainScore()},selectCell:function(t){return this.isClick=!0,this.gameModel.selectCell(t)},cleanCmd:function(){this.displayScore(),this.gameModel.cleanCmd(),this.curTime=0,this.isClick=!1},gameOver:function(){this.scoreDisplayEnd.string="Score :"+this.gameModel.gainScore(),this.grid.stopAllActions(),this.gameover.active=!0},update:function(t){if(this.curTime+=t,this.curTime-this.startTime>2&&0==this.isClick){var e=[];if(e=this.gameModel.findSelectCell(),console.log(e[0].count+" "+e[0]),!e[0]&&this.gameModel.death_sign){console.log("---Refresh---");this.gameModel.reInitWithData(),(s=this.grid.getComponent("GridView")).setController(this),s.resetGrid(),console.log("---New Seting OK---"),this.gameOver(),sss+=1}console.log("click cell "+e[0].reverse()+"@@@@@"+e[1].reverse()+"#####"+e[2].reverse());var s,i=e[0].reverse(),l=cc.v2(-1,-1);l.x=i[1],l.y=i[0],(s=this.grid.getComponent("GridView")).selectCell(l)}}}),cc._RF.pop()},{"../Model/GameModel":"GameModel"}],GameModelTest:[function(t,e,s){"use strict";cc._RF.push(e,"16fce9lOkpA7a2vuhmMkDMZ","GameModelTest"),cc.Class({extends:cc.Component,properties:{}}),cc._RF.pop()},{}],GameModel:[function(t,e,s){"use strict";cc._RF.push(e,"cc442HaMlBE/ZKi7W/YUKwd","GameModel"),Object.defineProperty(s,"__esModule",{value:!0}),s.default=o;var i=function(t){return t&&t.__esModule?t:{default:t}}(t("./CellModel")),l=t("./ConstValue");function o(){this.cells=null,this.cellBgs=null,this.lastPos=cc.v2(-1,-1),this.cellTypeNum=5,this.cellCreateType=[],this.score=0,this.death_sign=!1,this.data=[]}o.prototype.init=function(t){this.cells=[],this.setCellTypeNum(t||this.cellTypeNum);for(var e=1;e<=l.GRID_WIDTH;e++){this.cells[e]=[];for(var s=1;s<=l.GRID_HEIGHT;s++)this.cells[e][s]=new i.default}for(e=1;e<=l.GRID_WIDTH;e++)for(s=1;s<=l.GRID_HEIGHT;s++)for(var o=!0;o;){o=!1,this.cells[e][s].init(this.getRandomCellType()),this.checkPoint(s,e)[0].length>2&&(o=!0),this.cells[e][s].setXY(s,e),this.cells[e][s].setStartXY(s,e)}},o.prototype.reInitWithData=function(){for(var t=[],e=0;e<l.GRID_HEIGHT*l.GRID_WIDTH;e++)t[e]=!1;console.log(t);for(var s=5;s<=l.GRID_WIDTH;s++)for(var i=5;i<=l.GRID_HEIGHT;i++){var o=cc.v2(s,i),c=Math.floor(Math.random()*(1+l.GRID_WIDTH-1)+1),n=Math.floor(Math.random()*(1+l.GRID_HEIGHT-1)+1),h=cc.v2(c,n);if(t[s*l.GRID_WIDTH+i-1]||t[c*l.GRID_WIDTH+n-1]||s==c||i==n)break;this.exchangeCell(o,h);var a=this.cells[s][i].type;this.cells[c][n].type=a,this.cells[s][i].type=this.cells[c][n].type,t[s*l.GRID_WIDTH+i-1]=!0,t[c*l.GRID_WIDTH+n-1]=!0}return this.cells},o.prototype.gainScore=function(){var t=0;return this.score+=0,t+=this.score},o.prototype.checkPoint=function(t,e){var s=function(t,e,s){var i=[],o=[];o[t+e*l.GRID_HEIGHT]=!0,i.push(cc.v2(t,e));for(var c=0;c<i.length;){var n=i[c],h=this.cells[n.y][n.x];if(c++,h)for(var a=0;a<s.length;a++){var r=n.x+s[a].x,u=n.y+s[a].y;r<1||r>l.GRID_WIDTH||u<1||u>l.GRID_HEIGHT||o[r+u*l.GRID_HEIGHT]||!this.cells[u][r]||h.type==this.cells[u][r].type&&(o[r+u*l.GRID_HEIGHT]=!0,i.push(cc.v2(r,u)))}}return i},i=s.call(this,t,e,[cc.v2(1,0),cc.v2(-1,0)]),o=s.call(this,t,e,[cc.v2(0,-1),cc.v2(0,1)]),c=[],n="";if(i.length>=5||o.length>=5||(i.length>=3&&o.length>=3?n=l.CELL_STATUS.WRAP:i.length>=4||o.length),i.length>=3&&(c=i),o.length>=3){var h=c.concat();o.forEach(function(t){var e=!1;h.forEach(function(s){t.x==s.x&&t.y==s.y&&(e=!0)},this),e||c.push(t)},this)}return[c,n,this.cells[e][t].type]},o.prototype.printInfo=function(){for(var t=1;t<=9;t++){for(var e="",s=1;s<=9;s++)e+=this.cells[t][s].type+" ";console.log(e+"this is celles info")}},o.prototype.getCells=function(){return this.cells},o.prototype.selectCell=function(t){this.changeModels=[],this.effectsQueue=[];var e=this.lastPos;if(console.log("current cell position "+t+" Last cell position "+e),1!=Math.abs(t.x-e.x)+Math.abs(t.y-e.y))return this.lastPos=t,[[],[]];var s=this.cells[t.y][t.x],i=this.cells[e.y][e.x];this.exchangeCell(e,t);var o=this.checkPoint(t.x,t.y)[0],c=this.checkPoint(e.x,e.y)[0];this.curTime=0,this.pushToChangeModels(s),this.pushToChangeModels(i);var n=s.status!=l.CELL_STATUS.COMMON&&i.status!=l.CELL_STATUS.COMMON||s.status==l.CELL_STATUS.BIRD||i.status==l.CELL_STATUS.BIRD;if(o.length<3&&c.length<3&&!n)return this.exchangeCell(e,t),s.moveToAndBack(e),i.moveToAndBack(t),this.lastPos=cc.v2(-1,-1),[this.changeModels];this.lastPos=cc.v2(-1,-1),s.moveTo(e,this.curTime),i.moveTo(t,this.curTime);var h=[t,e];return this.curTime+=l.ANITIME.TOUCH_MOVE,this.processCrush(h),this.score+=30,[this.changeModels,this.effectsQueue]},o.prototype.processCrush=function(t){for(var e=0;t.length>0;){var s=[];if(0==e&&2==t.length){var i=t[0],o=t[1],c=this.cells[i.y][i.x],n=this.cells[o.y][o.x];if(c.status==l.CELL_STATUS.BIRD&&n.status==l.CELL_STATUS.BIRD){for(var h=1;h<=l.GRID_WIDTH;h++)for(var a=1;a<=l.GRID_HEIGHT;a++)this.cells[h][a]&&this.cells[h][a].status!=l.CELL_STATUS.COMMON&&(console.log("\u6b64\u5904\u9700\u8981\u6539\u53d8\u6bcf\u4e2a\u52a8\u7269\u7684\u7279\u6548\u540e\u5ef6\u65f60.3s\u540e\u518d\u6d88\u9664"),s.push(this.cells[h][a]));for(var r=1;r<=l.GRID_HEIGHT;r++)for(var u=1;u<=l.GRID_WIDTH;u++)this.crushCell(u,r,!1,e)}if(c.status==l.CELL_STATUS.BIRD&&n.status==l.CELL_STATUS.LINE||c.status==l.CELL_STATUS.BIRD&&n.status==l.CELL_STATUS.COLUMN||c.status==l.CELL_STATUS.BIRD&&n.status==l.CELL_STATUS.WRAP){var p=n.type;console.log("\u5982\u679cBIRD \u548c\u5176\u4ed6LINE COLUMN WRAP \u7279\u6548\u4e4b\u95f4\u4e24\u4e24\u4ea4\u6362\uff0c"+p);for(var f=1;f<=l.GRID_HEIGHT;f++)for(var T=1;T<=l.GRID_WIDTH;T++)this.cells[f][T]&&this.cells[f][T].type==p&&(this.cells[f][T].status=n.status,console.log("\u6b64\u5904\u9700\u8981\u6539\u53d8\u6bcf\u4e2a\u52a8\u7269\u7684\u7279\u6548\u540e\u5ef6\u65f60.3s\u540e\u518d\u6d88\u9664"),s.push(this.cells[f][T]),this.changeModels.push(this.cells[f][T]))}if(c.status==l.CELL_STATUS.LINE&&n.status==l.CELL_STATUS.BIRD||c.status==l.CELL_STATUS.COLUMN&&n.status==l.CELL_STATUS.BIRD||c.status==l.CELL_STATUS.WRAP&&n.status==l.CELL_STATUS.BIRD){var d=c.type;console.log("\u5982\u679c\u5176\u4ed6LINE COLUMN WRAP \u4e0eBOIRD\u7279\u6548\u4e4b\u95f4\u4e24\u4e24\u4ea4\u6362\uff0c"+d);for(var y=1;y<=l.GRID_HEIGHT;y++)for(var C=1;C<=l.GRID_WIDTH;C++)this.cells[y][C]&&this.cells[y][C].type==d&&(this.cells[y][C].status=c.status,console.log("\u6b64\u5904\u9700\u8981\u6539\u53d8\u6bcf\u4e2a\u52a8\u7269\u7684\u7279\u6548\u540e\u5ef6\u65f60.3s\u540e\u518d\u6d88\u9664"),s.push(this.cells[y][C]),this.changeModels.push(this.cells[y][C]))}if(c.status==l.CELL_STATUS.BIRD&&n.status==l.CELL_STATUS.COMMON&&(c.type=n.type,s.push(c)),c.status==l.CELL_STATUS.COMMON&&n.status==l.CELL_STATUS.BIRD&&(n.type=c.type,s.push(n)),(c.status==l.CELL_STATUS.LINE&&n.status==l.CELL_STATUS.LINE||c.status==l.CELL_STATUS.COLUMN&&n.status==l.CELL_STATUS.COLUMN||c.status==l.CELL_STATUS.LINE&&n.status==l.CELL_STATUS.COLUMN||c.status==l.CELL_STATUS.COLUMN&&n.status==l.CELL_STATUS.LINE)&&(s.push(c),s.push(n)),c.status==l.CELL_STATUS.WRAP&&n.status==l.CELL_STATUS.WRAP&&(s.push(c),s.push(n)),c.status==l.CELL_STATUS.LINE&&n.status==l.CELL_STATUS.WRAP||c.status==l.CELL_STATUS.WRAP&&n.status==l.CELL_STATUS.LINE)if(c.status==l.CELL_STATUS.LINE)for(var _=c.y,I=1;I<=l.GRID_WIDTH;I++)for(var L=1;L<=l.GRID_HEIGHT;L++)I>=_-1&&I<=_+1&&this.cells[I][L]&&this.crushCell(L,I,!1,e);else for(var E=n.y,m=1;m<=l.GRID_WIDTH;m++)for(var v=1;v<=l.GRID_HEIGHT;v++)m>=E-1&&m<=E+1&&this.cells[m][v]&&this.crushCell(v,m,!1,e);if(c.status==l.CELL_STATUS.WRAP&&n.status==l.CELL_STATUS.COLUMN||c.status==l.CELL_STATUS.COLUMN&&n.status==l.CELL_STATUS.WRAP)if(c.status==l.CELL_STATUS.COLUMN)for(var M=c.x,S=1;S<=l.GRID_WIDTH;S++)for(var g=1;g<=l.GRID_HEIGHT;g++)g>=M-1&&g<=M+1&&this.cells[S][g]&&this.crushCell(g,S,!1,e);else for(var D=n.x,A=1;A<=l.GRID_WIDTH;A++)for(var R=1;R<=l.GRID_HEIGHT;R++)R>=D-1&&R<=D+1&&this.cells[A][R]&&this.crushCell(R,A,!1,e)}for(var G in t){var H=t[G];if(this.cells[H.y][H.x]){var U=this.checkPoint(H.x,H.y),x=U[0],B=U[1],N=U[2];if(!(x.length<3)){for(var O in x){var V=this.cells[x[O].y][x[O].x];this.crushCell(x[O].x,x[O].y,!1,e),V.status!=l.CELL_STATUS.COMMON&&s.push(V)}this.createNewCell(H,B,N)}}}this.processBomb(s,e),this.curTime+=l.ANITIME.DIE,t=this.down(),e++}},o.prototype.createNewCell=function(t,e,s){if(""!=e){e==l.CELL_STATUS.BIRD&&(s=l.CELL_TYPE.BIRD);var o=new i.default;this.cells[t.y][t.x]=o,o.init(s),o.setStartXY(t.x,t.y),o.setXY(t.x,t.y),o.setStatus(e),o.setVisible(0,!1),o.setVisible(this.curTime,!0),this.changeModels.push(o)}},o.prototype.down=function(){for(var t=[],e=1;e<=l.GRID_WIDTH;e++)for(var s=1;s<=l.GRID_HEIGHT;s++)if(null==this.cells[e][s]){for(var o=e,c=o;c<=l.GRID_HEIGHT;c++)this.cells[c][s]&&(this.pushToChangeModels(this.cells[c][s]),t.push(this.cells[c][s]),this.cells[o][s]=this.cells[c][s],this.cells[c][s]=null,this.cells[o][s].setXY(s,o),this.cells[o][s].moveTo(cc.v2(s,o),this.curTime),o++);var n=1;for(c=o;c<=l.GRID_HEIGHT;c++)this.cells[c][s]=new i.default,this.cells[c][s].init(this.getRandomCellType()),this.cells[c][s].setStartXY(s,n+l.GRID_HEIGHT),this.cells[c][s].setXY(s,n+l.GRID_HEIGHT),this.cells[c][s].moveTo(cc.v2(s,c),this.curTime),n++,this.changeModels.push(this.cells[c][s]),t.push(this.cells[c][s])}return this.curTime+=l.ANITIME.TOUCH_MOVE+.3,t},o.prototype.pushToChangeModels=function(t){-1==this.changeModels.indexOf(t)&&this.changeModels.push(t)},o.prototype.cleanCmd=function(){for(var t=1;t<=l.GRID_WIDTH;t++)for(var e=1;e<=l.GRID_HEIGHT;e++)this.cells[t][e]&&(this.cells[t][e].cmd=[])},o.prototype.exchangeCell=function(t,e){var s=this.cells[t.y][t.x];this.cells[t.y][t.x]=this.cells[e.y][e.x],this.cells[t.y][t.x].x=t.x,this.cells[t.y][t.x].y=t.y,this.cells[e.y][e.x]=s,this.cells[e.y][e.x].x=e.x,this.cells[e.y][e.x].y=e.y},o.prototype.setCellTypeNum=function(t){this.cellTypeNum=t,this.cellCreateType=[];for(var e=1;e<=t;e++)for(;;){var s=Math.floor(Math.random()*l.CELL_BASENUM)+1;if(-1==this.cellCreateType.indexOf(s)){this.cellCreateType.push(s);break}}},o.prototype.getRandomCellType=function(){var t=Math.floor(Math.random()*this.cellTypeNum);return console.log(this.cellCreateType[t]+" this.cellCreateType[index]"),this.cellCreateType[t]},o.prototype.processBomb=function(t,e){for(var s=this,i=function(){var i=[],o=l.ANITIME.BOMB_DELAY;t.forEach(function(t){if(t.status==l.CELL_STATUS.LINE){for(var s=1;s<=l.GRID_WIDTH;s++)this.cells[t.y][s]&&(this.cells[t.y][s].status!=l.CELL_STATUS.COMMON&&i.push(this.cells[t.y][s]),this.crushCell(s,t.y,!1,e));this.score+=200,this.addRowBomb(this.curTime,cc.v2(t.x,t.y))}else if(t.status==l.CELL_STATUS.COLUMN){for(var c=1;c<=l.GRID_HEIGHT;c++)this.cells[c][t.x]&&(this.cells[c][t.x].status!=l.CELL_STATUS.COMMON&&i.push(this.cells[c][t.x]),this.crushCell(t.x,c,!1,e));this.score+=200,this.addColBomb(this.curTime,cc.v2(t.x,t.y))}else if(t.status==l.CELL_STATUS.WRAP){var n=t.x,h=t.y;this.score+=500;for(var a=1;a<=l.GRID_WIDTH;a++)for(var r=1;r<=l.GRID_HEIGHT;r++){var u=Math.abs(n-r)+Math.abs(h-a);this.cells[a][r]&&u<=2&&(this.cells[a][r].status!=l.CELL_STATUS.COMMON&&i.push(this.cells[a][r]),this.crushCell(r,a,!1,e))}}else if(t.status==l.CELL_STATUS.BIRD){var p=t.type;o<l.ANITIME.BOMB_BIRD_DELAY&&(o=l.ANITIME.BOMB_BIRD_DELAY),p==l.CELL_TYPE.BIRD&&(p=this.getRandomCellType());for(var f=1;f<=l.GRID_WIDTH;f++)for(var T=1;T<=l.GRID_HEIGHT;T++)this.cells[f][T]&&this.cells[f][T].type==p&&(this.cells[f][T].status!=l.CELL_STATUS.COMMON&&i.push(this.cells[f][T]),this.crushCell(T,f,!0,e));this.score+=1e3}},s),t.length>0&&(s.curTime+=o),t=i};t.length>0;)i()},o.prototype.addCrushEffect=function(t,e,s){this.effectsQueue.push({playTime:t,pos:e,action:"crush",step:s})},o.prototype.addRowBomb=function(t,e){this.effectsQueue.push({playTime:t,pos:e,action:"rowBomb"})},o.prototype.addColBomb=function(t,e){this.effectsQueue.push({playTime:t,pos:e,action:"colBomb"})},o.prototype.addWrapBomb=function(t,e){},o.prototype.crushCell=function(t,e,s,i){var o=this.cells[e][t];this.pushToChangeModels(o),s?(o.toShake(this.curTime),o.toDie(this.curTime+l.ANITIME.DIE_SHAKE),this.score+=30*i):(o.toDie(this.curTime),this.score+=30*i),this.addCrushEffect(this.curTime,cc.v2(o.x,o.y),i),this.cells[e][t]=null},o.prototype.findSelectCell=function(){for(var t=[],e=0;e<3;e++)t[e]=[];for(var s=2;s<=l.GRID_WIDTH-2;s++)for(var i=2;i<=l.GRID_HEIGHT-2;i++)if(this.cells[s][i]){if(this.cells[s][i].type==this.cells[s+1][i].type&&this.cells[s-1][i-1]&&this.cells[s+1][i-1]&&this.cells[s-1][i+2]&&this.cells[s+1][i+2]&&this.cells[s][i+1]){if(this.cells[s][i].type==this.cells[s-1][i-1].type&&this.cells[s][i-1])return this.death_sign=!1,t[0]=[s,i],t[1]=[s+1,i],t[2]=[s-1,i-1],console.log(this.cells[s][i].type+"@@@@@@@@@@@111 "+this.cells[s-1][i-1].type),t;if(this.cells[s][i].type==this.cells[s-1][i+1].type&&this.cells[s][i-1])return this.death_sign=!1,t[0]=[s,i],t[1]=[s+1,i],t[2]=[s-1,i+1],console.log(this.cells[s][i].type+"@@@@@@@@@@@222 "+this.cells[s-1][i+1].type),t;if(this.cells[s][i].type==this.cells[s+2][i+1].type&&this.cells[s][i+2])return this.death_sign=!1,t[0]=[s,i],t[1]=[s+1,i],t[2]=[s+2,i+1],console.log(this.cells[s][i].type+"@@@@@@@@@@@333 "+this.cells[s+2][i+1].type),t;if(this.cells[s][i].type==this.cells[s+2][i-1].type&&this.cells[s][i+2])return this.death_sign=!1,t[0]=[s,i],t[1]=[s+1,i],t[2]=[s+2,i-1],console.log(this.cells[s][i].type+"@@@@@@@@@@@444 "+this.cells[s+2][i-1].type),t}if(this.cells[s][i].type==this.cells[s][i+1].type&&this.cells[s-1][i-1]&&this.cells[s-1][i+1]&&this.cells[s+2][i-1]&&this.cells[s+2][i+1]&&this.cells[s+1][i]){if(this.cells[s][i].type==this.cells[s-1][i-1].type&&this.cells[s-1][i])return this.death_sign=!1,t[0]=[s,i],t[1]=[s,i+1],t[2]=[s-1,i-1],console.log(this.cells[s][i].type+"@@@@@@@@@@@555 "+this.cells[s-1][i-1].type),t;if(this.cells[s][i].type==this.cells[s-1][i+2].type&&this.cells[s-1][i])return this.death_sign=!1,t[0]=[s,i],t[1]=[s,i+1],t[2]=[s-1,i+2],console.log(this.cells[s][i].type+"@@@@@@@@@@@666 "+this.cells[s-1][i+2].type),t;if(this.cells[s][i].type==this.cells[s+1][i-1].type&&this.cells[s+2][i])return this.death_sign=!1,t[0]=[s,i],t[1]=[s,i+1],t[2]=[s+1,i-1],console.log(this.cells[s][i].type+"@@@@@@@@@@@777 "+this.cells[s+1][i-1].type),t;if(this.cells[s][i].type==this.cells[s+1][i+2].type&&this.cells[s+2][i])return this.death_sign=!1,t[0]=[s,i],t[1]=[s,i+1],t[2]=[s+1,i+2],console.log(this.cells[s][i].type+"@@@@@@@@@@@888 "+this.cells[s+1][i+2].type),t}else{if(this.cells[s][i].type==this.cells[s-1][i-1].type&&this.cells[s-1][i+1]&&this.cells[s-1][i]&&this.cells[s+1][i-1]&&this.cells[s][i-1]&&this.cells[s-1][i-1]){if(this.cells[s][i].type==this.cells[s-1][i+1].type&&this.cells[s-1][i])return this.death_sign=!1,t[0]=[s,i],t[1]=[s-1,i-1],t[2]=[s-1,i+1],console.log(this.cells[s][i].type+"@@@@@@@@@@@999 "+this.cells[s-1][i+1].type),t;if(this.cells[s][i].type==this.cells[s+1][i-1].type&&this.cells[s][i-1])return this.death_sign=!1,t[0]=[s,i],t[1]=[s-1,i-1],t[2]=[s+1,i-1],console.log(this.cells[s][i].type+"@@@@@@@@@@@xxx "+this.cells[s+1][i-1].type),t}if(this.cells[s][i].type==this.cells[s+1][i+1].type&&this.cells[s-1][i+1]&&this.cells[s][i+1]&&this.cells[s+1][i-1]&&this.cells[s+1][i]&&this.cells[s+1][i+1]){if(this.cells[s][i].type==this.cells[s-1][i+1].type&&this.cells[s][i+1])return this.death_sign=!1,t[0]=[s,i],t[1]=[s+1,i+1],t[2]=[s-1,i+1],console.log(this.cells[s][i].type+"@@@@@@@@@@@aaa "+this.cells[s-1][i+1].type),t;if(this.cells[s][i].type==this.cells[s+1][i-1].type&&this.cells[s+1][i])return this.death_sign=!1,t[0]=[s,i],t[1]=[s+1,i+1],t[2]=[s+1,i-1],console.log(this.cells[s][i].type+"@@@@@@@@@@@bbb "+this.cells[s+1][i-1].type),t}}}},e.exports=s.default,cc._RF.pop()},{"./CellModel":"CellModel","./ConstValue":"ConstValue"}],GridView:[function(t,e,s){"use strict";cc._RF.push(e,"d0d1fDj9rlDx5QUtP+2toQV","GridView");var i=t("../Model/ConstValue"),l=o(t("../Utils/AudioUtils"));o(t("../Model/CellModel"));function o(t){return t&&t.__esModule?t:{default:t}}cc.Class({extends:cc.Component,properties:{aniPre:{default:[],type:[cc.Prefab]},effectLayer:{default:null,type:cc.Node},audioUtils:{type:l.default,default:null}},onLoad:function(){this.setListener(),this.lastTouchPos=cc.Vec2(-1,-1),this.isCanMove=!0,this.isInPlayAni=!1},setController:function(t){this.controller=t},initWithCellModels:function(t){this.cellViews=[];for(var e=1;e<=i.GRID_WIDTH;e++){this.cellViews[e]=[];for(var s=1;s<=i.GRID_HEIGHT;s++){var l=t[e][s].type,o=cc.instantiate(this.aniPre[l]);o.parent=this.node,o.getComponent("CellView").initWithModel(t[e][s]),this.cellViews[e][s]=o}}},setListener:function(){this.node.on(cc.Node.EventType.TOUCH_START,function(t){if(this.isInPlayAni)return!0;var e=t.getLocation(),s=this.convertTouchPosToCell(e);if(s){var i=this.selectCell(s);this.isCanMove=i.length<3}else this.isCanMove=!1;return!0},this),this.node.on(cc.Node.EventType.TOUCH_END,function(t){},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(t){if(this.isCanMove){var e=t.getStartLocation(),s=this.convertTouchPosToCell(e),i=t.getLocation(),l=this.convertTouchPosToCell(i);if(s.x!=l.x||s.y!=l.y){this.isCanMove=!1;this.selectCell(l)}}},this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(t){},this)},convertTouchPosToCell:function(t){if((t=this.node.convertToNodeSpace(t)).x<0||t.x>=i.GRID_PIXEL_WIDTH||t.y<0||t.y>=i.GRID_PIXEL_HEIGHT)return!1;var e=Math.floor(t.x/i.CELL_WIDTH)+1,s=Math.floor(t.y/i.CELL_HEIGHT)+1;return cc.v2(e,s)},selectCell:function(t){var e=this.controller.selectCell(t),s=e[0],i=e[1];return this.playEffect(i),this.disableTouch(this.getPlayAniTime(s),this.getStep(i)),this.updateView(s),this.controller.cleanCmd(),s.length>=2?(this.updateSelect(cc.v2(-1,-1)),this.audioUtils.playSwap()):(this.updateSelect(t),this.audioUtils.playClick()),s},updateView:function(t){var e=[];for(var s in t){var i=t[s],l=this.findViewByModel(i),o=null;if(l)o=l.view,this.cellViews[l.y][l.x]=null;else{var c=i.type,n=cc.instantiate(this.aniPre[c]);n.parent=this.node,n.getComponent("CellView").initWithModel(i),o=n}o.getComponent("CellView").updateView(),i.isDeath||e.push({model:i,view:o})}e.forEach(function(t){var e=t.model;this.cellViews[e.y][e.x]=t.view},this)},updateSelect:function(t){for(var e=1;e<=i.GRID_WIDTH;e++)for(var s=1;s<=i.GRID_HEIGHT;s++)if(this.cellViews[e][s]){var l=this.cellViews[e][s].getComponent("CellView");t.x==s&&t.y==e?l.setSelect(!0):l.setSelect(!1)}},findViewByModel:function(t){for(var e=1;e<=i.GRID_WIDTH;e++)for(var s=1;s<=i.GRID_HEIGHT;s++)if(this.cellViews[e][s]&&this.cellViews[e][s].getComponent("CellView").model==t)return{view:this.cellViews[e][s],x:s,y:e};return null},getPlayAniTime:function(t){if(!t)return 0;var e=0;return t.forEach(function(t){t.cmd.forEach(function(t){e<t.playTime+t.keepTime&&(e=t.playTime+t.keepTime)},this)},this),e},getStep:function(t){return t?t.reduce(function(t,e){return Math.max(t,e.step||0)},0):0},disableTouch:function(t,e){t<=0||(this.isInPlayAni=!0,this.node.runAction(cc.sequence(cc.delayTime(t),cc.callFunc(function(){this.isInPlayAni=!1,this.audioUtils.playContinuousMatch(e)},this))))},playEffect:function(t){this.effectLayer.getComponent("EffectLayer").playEffects(t)},resetGrid:function(){cc.director.loadScene("Game")}}),cc._RF.pop()},{"../Model/CellModel":"CellModel","../Model/ConstValue":"ConstValue","../Utils/AudioUtils":"AudioUtils"}],Home:[function(t,e,s){"use strict";cc._RF.push(e,"27a60UBuJFGYqWABEq+j+cu","Home"),cc.Class({extends:cc.Component,properties:{Loading:{default:null,type:cc.Node}},onLoad:function(){this.Loading.active=!1},gameStart:function(){this.Loading.active=!0,cc.director.loadScene("Game")}}),cc._RF.pop()},{}],LoginController:[function(t,e,s){"use strict";cc._RF.push(e,"5f4845Bus5AQoZakK7KAXht","LoginController");(function(t){t&&t.__esModule})(t("../Utils/AudioUtils"));cc.Class({extends:cc.Component,properties:{loadingBar:{type:cc.ProgressBar,default:null},loginButton:{type:cc.Button,default:null},worldSceneBGM:{type:cc.AudioClip,default:null}},onLoad:function(){this.gameSceneBGMAudioId=cc.audioEngine.play(this.worldSceneBGM,!0,1)},start:function(){},onLogin:function(){this.loadingBar.node.active=!1,this.loginButton.node.active=!1,this.loadingBar.progress=0;var t=cc.loader.onProgress;cc.loader.onProgress=function(t,e){this.loadingBar.progress=t/e}.bind(this),cc.director.preloadScene("Game",function(){cc.loader.onProgress=t,this.loadingBar.node.active=!1,this.loginButton.node.active=!0,cc.director.loadScene("Game")}.bind(this))},onDestroy:function(){cc.audioEngine.stop(this.gameSceneBGMAudioId)}}),cc._RF.pop()},{"../Utils/AudioUtils":"AudioUtils"}]},{},["GameController","LoginController","Home","CellModel","ConstValue","GameModel","GameModelTest","AudioUtils","CellView","EffectLayer","GridView"]);